##
# AudioShift â€” git-cliff configuration
# Track 4: CHANGELOG automation
#
# Usage:
#   git-cliff --output CHANGELOG.md           # full history
#   git-cliff --unreleased --tag v1.0.0       # next release notes
#   git-cliff --latest                        # last tag only
#
# Install: cargo install git-cliff  (or)  npm install -g git-cliff
##

[changelog]
header = """
# AudioShift â€” Changelog

All notable changes to AudioShift are documented here.
Commit messages follow [Conventional Commits](https://www.conventionalcommits.org/) format.

"""

body = """
{% if version %}\
## [{{ version | trim_start_matches(pat="v") }}] â€” {{ timestamp | date(format="%Y-%m-%d") }}
{% else %}\
## [Unreleased]
{% endif %}\
{% for group, commits in commits | group_by(attribute="group") %}\
### {{ group | upper_first }}
{% for commit in commits %}\
- {% if commit.scope %}**{{ commit.scope }}:** {% endif %}\
{{ commit.message | upper_first }}\
 ([`{{ commit.id | truncate(length=7, end="") }}`]({{ remote.github.url }}/commit/{{ commit.id }}))\
{% if commit.breaking %} âš ï¸ **BREAKING CHANGE**{% endif %}
{% endfor %}
{% endfor %}\n
"""

footer = """
---
*Generated by [git-cliff](https://git-cliff.org) from [Conventional Commits](https://www.conventionalcommits.org/).*
"""

trim = true

# Remove the prefix from commit messages (e.g. "feat(scope): message" â†’ "message")
postprocessors = [
  { pattern = '\n\n', replace = "\n" },
]

[git]
conventional_commits  = true
filter_unconventional = true
split_commits         = false

commit_preprocessors = [
  # Strip trailing whitespace
  { pattern = '  +', replace = " " },
]

commit_parsers = [
  { message = "^feat",      group = "ğŸš€ Features"        },
  { message = "^fix",       group = "ğŸ› Bug Fixes"        },
  { message = "^perf",      group = "âš¡ Performance"      },
  { message = "^refactor",  group = "â™»ï¸  Refactoring"     },
  { message = "^docs",      group = "ğŸ“– Documentation"    },
  { message = "^test",      group = "ğŸ§ª Testing"          },
  { message = "^ci",        group = "âš™ï¸  CI/CD"           },
  { message = "^build",     group = "ğŸ”§ Build System"     },
  { message = "^chore",     group = "ğŸ—ƒ  Chores"           },
  { message = "^revert",    group = "âª Reverts"          },
  { message = "^style",     skip = true                   },
  { message = "^wip",       skip = true                   },
  { body    = ".*security", group = "ğŸ” Security"         },
]

# Protect breaking change commits from being skipped
protect_breaking_commits = true

# Filter out commits not matching any group
filter_commits = false

# Glob pattern to match git tags
tag_pattern = "v[0-9].*"

# Regex for ignoring tags (pre-1.0 tags skip the changelog)
skip_tags = "v0\\.0\\..*"

# Tags to ignore (e.g. test tags)
ignore_tags = ""

# Sort by oldest first within a release section
sort_commits = "oldest"

# Topological sort (DAG traversal) â€” false = chronological
topo_order = false

[remote.github]
owner = "iamthegreatdestroyer"
repo  = "audioshift"
